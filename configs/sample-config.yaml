# GoRecon Configuration File
# This is a comprehensive example configuration showing all available options

# Global settings that apply to the entire application
global:
  # Maximum number of concurrent plugin executions
  concurrency: 8
  
  # Default timeout for plugin execution
  plugin_timeout: "15m"
  
  # Require confirmation before running active scans
  confirm_active_scans: false
  
  # Default output directory
  output_dir: "./output"
  
  # Workspace directory for temporary files
  workspace_dir: "./workspace"
  
  # Default log level (debug, info, warn, error)
  log_level: "info"
  
  # Enable structured logging (JSON format)
  structured_logging: true

# Server configuration for API endpoints
server:
  # Host to bind to
  host: "127.0.0.1"
  
  # Port for REST API
  port: 8080
  
  # Enable HTTPS
  tls:
    enabled: false
    cert_file: "/path/to/cert.pem"
    key_file: "/path/to/key.pem"
  
  # Request timeout
  timeout: "30s"
  
  # Enable CORS for web clients
  cors:
    enabled: true
    allowed_origins: ["http://localhost:3000"]
    allowed_methods: ["GET", "POST", "PUT", "DELETE"]

# Database configuration
database:
  # Database type (sqlite, postgres, mysql)
  type: "sqlite"
  
  # Connection string
  url: "./gorecon.db"
  
  # Connection pool settings
  max_open_conns: 25
  max_idle_conns: 5
  max_lifetime: "1h"

# Redis configuration for caching and pub/sub
redis:
  # Redis server address
  address: "localhost:6379"
  
  # Redis password (leave empty if no auth)
  password: ""
  
  # Redis database number
  database: 0
  
  # Connection pool size
  pool_size: 10
  
  # Connection timeout
  dial_timeout: "5s"
  
  # Read/write timeouts
  read_timeout: "3s"
  write_timeout: "3s"

# Caching configuration
cache:
  # Enable caching
  enabled: true
  
  # Default TTL for cache entries
  default_ttl: "1h"
  
  # L1 cache (in-memory)
  l1:
    enabled: true
    max_entries: 10000
    ttl: "15m"
  
  # L2 cache (Redis)
  l2:
    enabled: true
    ttl: "1h"
  
  # L3 cache (S3/file system)
  l3:
    enabled: false
    type: "filesystem" # or "s3"
    path: "./cache"
    ttl: "24h"

# Plugin system configuration
plugins:
  # Maximum concurrent plugin executions
  max_concurrent: 5
  
  # Default plugin timeout
  timeout: "10m"
  
  # Number of retry attempts for failed plugins
  retry_attempts: 3
  
  # Delay between retry attempts
  retry_delay: "30s"
  
  # Plugin discovery paths
  paths:
    - "./plugins"
    - "/usr/local/share/gorecon/plugins"
  
  # Plugin registry URL for updates
  registry_url: "https://registry.gorecon.io/plugins"
  
  # Auto-update plugins
  auto_update: false
  
  # Plugin-specific configurations
  cloud_enum:
    enabled: true
    timeout: "5m"
    api_keys:
      aws_access_key: "${AWS_ACCESS_KEY_ID}"
      aws_secret_key: "${AWS_SECRET_ACCESS_KEY}"
  
  gau:
    enabled: true
    timeout: "2m"
    max_results: 10000
    include_subs: true
  
  meg:
    enabled: true
    timeout: "10m"
    concurrency: 20
    delay: "100ms"

# Intelligence and correlation engine
intelligence:
  # Enable correlation analysis
  correlation_enabled: true
  
  # Enable machine learning features
  ml_enabled: true
  
  # Enable anomaly detection
  anomaly_detection: true
  
  # Enable attack path analysis
  attack_path_analysis: true
  
  # Enable MITRE ATT&CK mapping
  mitre_mapping: true
  
  # Threat intelligence sources
  threat_intel:
    enabled: true
    sources:
      - "https://api.threatintel.example.com"
    api_key: "${THREAT_INTEL_API_KEY}"
  
  # Risk scoring configuration
  risk_scoring:
    enabled: true
    cvss_weight: 0.4
    confidence_weight: 0.3
    context_weight: 0.3
  
  # Correlation rules directory
  rules_dir: "./configs/correlation-rules"
  
  # Knowledge base configuration
  knowledge_base:
    mitre_data_url: "https://raw.githubusercontent.com/mitre/cti/master/enterprise-attack/enterprise-attack.json"
    update_interval: "24h"
    auto_update: true

# Rate limiting configuration
rate_limit:
  # Global rate limit (requests per second)
  global_rps: 100
  
  # Per-target rate limit
  per_target_rps: 10
  
  # Burst allowance
  burst: 20
  
  # Enable adaptive rate limiting
  adaptive: true
  
  # Human-like delays (randomization)
  human_mode: false
  
  # Custom delays for specific tools
  tool_delays:
    cloud_enum: "1s"
    meg: "100ms"
    gau: "500ms"

# Output and reporting configuration
output:
  # Default output formats
  formats: ["json", "html"]
  
  # Enable real-time streaming
  streaming:
    enabled: true
    websocket_port: 8081
    sse_endpoint: "/stream"
  
  # Report templates
  templates:
    executive: "./templates/executive.html"
    technical: "./templates/technical.html"
    compliance: "./templates/compliance.html"
  
  # Export settings
  export:
    include_raw_data: false
    compress_output: true
    encryption:
      enabled: false
      key_file: "/path/to/encryption.key"

# Security configuration
security:
  # Enable sandbox mode
  sandbox:
    enabled: true
    # Resource limits
    max_cpu: "80%"
    max_memory: "1GB"
    max_disk_io: "100MB/s"
    max_network_io: "50MB/s"
  
  # Network policies
  network:
    # Allow outbound connections
    allow_outbound: true
    # Blocked networks (CIDR notation)
    blocked_networks:
      - "127.0.0.0/8"
      - "192.168.0.0/16"
      - "10.0.0.0/8"
    # Allowed ports
    allowed_ports: [80, 443, 53, 22]
  
  # Authentication and authorization
  auth:
    enabled: true
    jwt_secret: "${JWT_SECRET}"
    token_expiry: "24h"
    
    # Role-based access control
    rbac:
      enabled: true
      roles_file: "./configs/rbac.yaml"
  
  # Audit logging
  audit:
    enabled: true
    log_file: "./logs/audit.log"
    max_size: "100MB"
    max_backups: 5
    max_age: 30

# Monitoring and observability
monitoring:
  # Enable metrics collection
  metrics:
    enabled: true
    prometheus:
      enabled: true
      port: 9090
      path: "/metrics"
  
  # Distributed tracing
  tracing:
    enabled: true
    jaeger:
      endpoint: "http://localhost:14268/api/traces"
      service_name: "gorecon"
  
  # Health checks
  health:
    enabled: true
    endpoint: "/health"
    checks:
      - "database"
      - "redis"
      - "plugins"

# Distributed scanning configuration
distributed:
  # Enable distributed mode
  enabled: false
  
  # Coordinator configuration
  coordinator:
    enabled: false
    port: 8090
    cluster_secret: "${CLUSTER_SECRET}"
  
  # Worker configuration  
  worker:
    enabled: false
    coordinator_url: "http://coordinator:8090"
    capabilities: ["all"]
    max_jobs: 10
    heartbeat_interval: "30s"
  
  # Load balancing
  load_balancer:
    algorithm: "round_robin" # round_robin, least_connections, weighted
    health_check_interval: "60s"

# Scan profiles for different scenarios
profiles:
  # Stealth profile for covert scanning
  stealth:
    rate_limit:
      requests_per_second: 1
      human_mode: true
      jitter: true
    
    plugins:
      exclude: ["aggressive_scanner", "loud_fuzzer"]
      timeouts:
        cloud_enum: "10m"
        gau: "5m"
        meg: "15m"
    
    evasion:
      rotate_user_agents: true
      use_proxies: true
      random_delays: true
  
  # Aggressive profile for comprehensive scanning
  aggressive:
    rate_limit:
      requests_per_second: 50
      human_mode: false
    
    plugins:
      include: ["all"]
      timeouts:
        default: "30m"
    
    intelligence:
      correlation_enabled: true
      attack_path_analysis: true
  
  # Quick profile for rapid assessment
  quick:
    plugins:
      include: ["cloud_enum", "gau", "httpprobe"]
      timeouts:
        default: "2m"
    
    rate_limit:
      requests_per_second: 20
    
    intelligence:
      correlation_enabled: false
  
  # Compliance profile for regulatory requirements
  compliance:
    plugins:
      include: ["cloud_enum", "vuln_scanner", "config_audit"]
    
    output:
      formats: ["json", "pdf", "sarif"]
      include_evidence: true
    
    reporting:
      compliance_frameworks: ["pci_dss", "gdpr", "hipaa"]

# Notification configuration
notifications:
  # Enable notifications
  enabled: false
  
  # Slack integration
  slack:
    enabled: false
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channels:
      - "#security-alerts"
    
    # Notification triggers
    triggers:
      - "critical_finding"
      - "scan_complete"
      - "system_error"
  
  # Email notifications
  email:
    enabled: false
    smtp:
      host: "smtp.example.com"
      port: 587
      username: "${SMTP_USERNAME}"
      password: "${SMTP_PASSWORD}"
    
    recipients:
      - "security@example.com"
      - "admin@example.com"
  
  # Webhook notifications
  webhook:
    enabled: false
    endpoints:
      - url: "https://api.example.com/webhooks/gorecon"
        secret: "${WEBHOOK_SECRET}"
        events: ["finding", "scan_complete"]

# Development and debugging
development:
  # Enable debug mode
  debug: false
  
  # Profiling
  profiling:
    enabled: false
    cpu_profile: "./profiles/cpu.prof"
    memory_profile: "./profiles/mem.prof"
  
  # Mock services for testing
  mocks:
    enabled: false
    mock_plugins: true
    mock_external_apis: true
  
  # Test fixtures
  fixtures:
    enabled: false
    data_dir: "./tests/fixtures"

# Logging configuration
logging:
  # Log level
  level: "info"
  
  # Log format (text, json)
  format: "json"
  
  # Log output (stdout, stderr, file)
  output: "stdout"
  
  # File logging settings
  file:
    path: "./logs/gorecon.log"
    max_size: "100MB"
    max_backups: 5
    max_age: 30
    compress: true
  
  # Fields to always include
  fields:
    service: "gorecon"
    environment: "${ENVIRONMENT}"
    version: "${VERSION}"